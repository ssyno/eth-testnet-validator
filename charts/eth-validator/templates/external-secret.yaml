{{- if .Values.externalSecrets.enabled }}
#
# External Secrets integration for KMS/Vault
# Requires External Secrets Operator: https://external-secrets.io
#
{{- if .Values.externalSecrets.validatorPassword.enabled }}
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: {{ include "eth-validator.fullname" . }}-validator-password
  labels:
    {{- include "eth-validator.labels" . | nindent 4 }}
spec:
  secretStoreRef:
    name: {{ .Values.externalSecrets.secretStore }}
    kind: {{ .Values.externalSecrets.secretStoreKind }}
  target:
    name: {{ .Values.validatorKeys.existingSecretName }}
    creationPolicy: Owner
    template:
      type: Opaque
      data:
        validator_password.txt: "{{ `{{ .password }}` }}"
  data:
    - secretKey: password
      remoteRef:
        key: {{ .Values.externalSecrets.validatorPassword.key }}
        {{- with .Values.externalSecrets.validatorPassword.property }}
        property: {{ . }}
        {{- end }}
  refreshInterval: {{ .Values.externalSecrets.refreshInterval }}
{{- end }}
{{- if .Values.externalSecrets.jwtSecret.enabled }}
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: {{ include "eth-validator.fullname" . }}-jwt
  labels:
    {{- include "eth-validator.labels" . | nindent 4 }}
spec:
  secretStoreRef:
    name: {{ .Values.externalSecrets.secretStore }}
    kind: {{ .Values.externalSecrets.secretStoreKind }}
  target:
    name: {{ .Values.jwtSecret.existingSecretName }}
    creationPolicy: Owner
    template:
      type: Opaque
      data:
        jwtsecret: "{{ `{{ .jwtsecret }}` }}"
  data:
    - secretKey: jwtsecret
      remoteRef:
        key: {{ .Values.externalSecrets.jwtSecret.key }}
        {{- with .Values.externalSecrets.jwtSecret.property }}
        property: {{ . }}
        {{- end }}
  refreshInterval: {{ .Values.externalSecrets.refreshInterval }}
{{- end }}
{{- end }}
